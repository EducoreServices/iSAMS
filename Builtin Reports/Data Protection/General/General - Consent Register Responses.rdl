<?xml version="1.0" encoding="utf-8"?><Report xmlns="http://schemas.microsoft.com/sqlserver/reporting/2010/01/reportdefinition" xmlns:rd="http://schemas.microsoft.com/SQLServer/reporting/reportdesigner"><AutoRefresh>0</AutoRefresh><DataSources><DataSource Name="iSAMS"><DataSourceReference>iSAMS</DataSourceReference><rd:SecurityType>None</rd:SecurityType><rd:DataSourceID>03217930-df84-4f03-808b-240ffb17ec88</rd:DataSourceID></DataSource></DataSources><DataSets><DataSet Name="ConsentRegister"><Query><DataSourceName>iSAMS</DataSourceName><QueryParameters><QueryParameter Name="@consentRegisterIds"><Value>=Parameters!consentRegisterIds.Value</Value></QueryParameter><QueryParameter Name="@includeOptedIn"><Value>=Parameters!includeOptedIn.Value</Value></QueryParameter><QueryParameter Name="@includeOptedOut"><Value>=Parameters!includeOptedOut.Value</Value></QueryParameter><QueryParameter Name="@includeNoResponse"><Value>=Parameters!includeNoResponse.Value</Value></QueryParameter><QueryParameter Name="@includeContacts"><Value>=Parameters!includeContacts.Value</Value></QueryParameter><QueryParameter Name="@includeStudents"><Value>=Parameters!includeStudents.Value</Value></QueryParameter><QueryParameter Name="@includeStaff"><Value>=Parameters!includeStaff.Value</Value></QueryParameter></QueryParameters><CommandText>DECLARE @consentRegisterIdsXml XML = CAST('&lt;a&gt;' + REPLACE(@consentRegisterIds,',','&lt;/a&gt;&lt;a&gt;') +'&lt;/a&gt;' AS XML);

WITH MainTableCTE AS 
	(SELECT	ConsentRegister.Id AS 'ConsentRegisterId', ConsentRegister.Title AS 'ConsentRegisterName', ConsentRegister.Enabled AS 'ConsentRegisterIsEnabled', TblPerson.TblPersonId AS 'PersonId'		
	 FROM	TblPerson
	 JOIN dataprotection.ConsentRegister ON 1 = 1
	)

SELECT	MainTableCTE.ConsentRegisterName AS 'txtConsentRegisterName',
		CASE WHEN MainTableCTE.ConsentRegisterIsEnabled = 1 THEN 'Yes' ELSE 'No' END AS 'txtConsentRegisterIsEnabled',
		COALESCE(ConsentRegisterResponseState.Name, 'No Response') AS 'txtStatus',
		TblPupilManagementAddresses.txtLabelSalutation AS 'txtNameAsContact',
		TblPupilManagementPupils.txtLabelSalutation AS 'txtNameAsStudent',	
		TblPupilManagementPupils.txtTitle AS 'txtStudentTitle',
		TblPupilManagementPupils.txtForename AS 'txtStudentForename',
		TblPupilManagementPupils.txtSurname AS 'txtStudentSurname',
		TblPupilManagementPupils.txtForm,
		TblPupilManagementPupils.intSystemStatus,
		TblStaff.LabelSalutation AS 'txtNameAsStaff',
		TblStaff.Firstname AS 'txtStaffForename',
		TblStaff.Surname AS 'txtStaffSurname',
		TblStaff.SystemStatus AS 'intStaffStatus'
FROM	MainTableCTE
LEFT OUTER JOIN dataprotection.ConsentRegisterResponse ON ConsentRegisterResponse.ConsentRegisterId = MainTableCTE.ConsentRegisterId AND ConsentRegisterResponse.PersonId = MainTableCTE.PersonId
LEFT OUTER JOIN dataprotection.ConsentRegisterResponseState ON ConsentRegisterResponseState.Id = ConsentRegisterResponse.StateId
LEFT OUTER JOIN dbo.TblPupilManagementAddresses ON TblPupilManagementAddresses.intPersonId = MainTableCTE.PersonId
LEFT OUTER JOIN dbo.TblPupilManagementPupils ON TblPupilManagementPupils.intPersonID = MainTableCTE.PersonId
LEFT OUTER JOIN dbo.TblStaff ON TblStaff.intPersonID = MainTableCTE.PersonId
WHERE	MainTableCTE.ConsentRegisterId IN (SELECT t.v.value('.','int') as ConsentRegisterId FROM @consentRegisterIdsXml.nodes('/a') as t(v)) 
		AND	((ConsentRegisterResponseState.Id = 1 AND @includeOptedIn = 1) OR (ConsentRegisterResponseState.Id = 0 AND @includeOptedOut = 1) OR (ConsentRegisterResponseState.Id IS NULL AND @includeNoResponse = 1)) 
		AND ((TblPupilManagementAddresses.TblPupilManagementAddressesId IS NOT NULL) OR (TblPupilManagementPupils.TblPupilManagementPupilsID IS NOT NULL) OR (TblStaff.TblStaffID IS NOT NULL))
		AND ((TblPupilManagementAddresses.TblPupilManagementAddressesId IS NOT NULL AND @includeContacts = 1) OR (TblPupilManagementPupils.TblPupilManagementPupilsID IS NOT NULL AND @includeStudents = 1) OR (TblStaff.TblStaffID IS NOT NULL AND @includeStaff = 1))
		AND	(TblPupilManagementPupils.intSystemStatus IN (1, 0, -1))</CommandText></Query><Fields><Field Name="txtConsentRegisterName"><DataField>txtConsentRegisterName</DataField><rd:TypeName>System.String</rd:TypeName></Field><Field Name="txtConsentRegisterIsEnabled"><DataField>txtConsentRegisterIsEnabled</DataField><rd:TypeName>System.String</rd:TypeName></Field><Field Name="txtStatus"><DataField>txtStatus</DataField><rd:TypeName>System.String</rd:TypeName></Field><Field Name="txtNameAsContact"><DataField>txtNameAsContact</DataField><rd:TypeName>System.String</rd:TypeName></Field><Field Name="txtNameAsStudent"><DataField>txtNameAsStudent</DataField><rd:TypeName>System.String</rd:TypeName></Field><Field Name="txtStudentTitle"><DataField>txtStudentTitle</DataField><rd:TypeName>System.String</rd:TypeName></Field><Field Name="txtStudentForename"><DataField>txtStudentForename</DataField><rd:TypeName>System.String</rd:TypeName></Field><Field Name="txtStudentSurname"><DataField>txtStudentSurname</DataField><rd:TypeName>System.String</rd:TypeName></Field><Field Name="txtForm"><DataField>txtForm</DataField><rd:TypeName>System.String</rd:TypeName></Field><Field Name="intSystemStatus"><DataField>intSystemStatus</DataField><rd:TypeName>System.Int32</rd:TypeName></Field><Field Name="txtNameAsStaff"><DataField>txtNameAsStaff</DataField><rd:TypeName>System.String</rd:TypeName></Field><Field Name="txtStaffForename"><DataField>txtStaffForename</DataField><rd:TypeName>System.String</rd:TypeName></Field><Field Name="txtStaffSurname"><DataField>txtStaffSurname</DataField><rd:TypeName>System.String</rd:TypeName></Field><Field Name="intStaffStatus"><DataField>intStaffStatus</DataField><rd:TypeName>System.Int32</rd:TypeName></Field></Fields></DataSet></DataSets><ReportSections><ReportSection><Body><ReportItems><Tablix Name="Tablix1"><TablixBody><TablixColumns><TablixColumn><Width>4cm</Width></TablixColumn><TablixColumn><Width>3.7cm</Width></TablixColumn><TablixColumn><Width>2cm</Width></TablixColumn><TablixColumn><Width>4cm</Width></TablixColumn><TablixColumn><Width>4cm</Width></TablixColumn><TablixColumn><Width>2cm</Width></TablixColumn><TablixColumn><Width>2cm</Width></TablixColumn><TablixColumn><Width>4cm</Width></TablixColumn></TablixColumns><TablixRows><TablixRow><Height>0.6cm</Height><TablixCells><TablixCell><CellContents><Textbox Name="Textbox15"><CanGrow>true</CanGrow><KeepTogether>true</KeepTogether><Paragraphs><Paragraph><TextRuns><TextRun><Value>Consent Register Name</Value><Style><FontFamily>Arial</FontFamily><FontWeight>Bold</FontWeight></Style></TextRun></TextRuns><Style /></Paragraph></Paragraphs><rd:DefaultName>Textbox15</rd:DefaultName><Style><Border><Style>Solid</Style></Border><PaddingLeft>2pt</PaddingLeft><PaddingRight>2pt</PaddingRight><PaddingTop>2pt</PaddingTop><PaddingBottom>2pt</PaddingBottom></Style></Textbox></CellContents></TablixCell><TablixCell><CellContents><Textbox Name="Textbox17"><CanGrow>true</CanGrow><KeepTogether>true</KeepTogether><Paragraphs><Paragraph><TextRuns><TextRun><Value>Consent Register Is Enabled</Value><Style><FontFamily>Arial</FontFamily><FontWeight>Bold</FontWeight></Style></TextRun></TextRuns><Style /></Paragraph></Paragraphs><rd:DefaultName>Textbox17</rd:DefaultName><Style><Border><Style>Solid</Style></Border><PaddingLeft>2pt</PaddingLeft><PaddingRight>2pt</PaddingRight><PaddingTop>2pt</PaddingTop><PaddingBottom>2pt</PaddingBottom></Style></Textbox></CellContents></TablixCell><TablixCell><CellContents><Textbox Name="Textbox19"><CanGrow>true</CanGrow><KeepTogether>true</KeepTogether><Paragraphs><Paragraph><TextRuns><TextRun><Value>Status</Value><Style><FontFamily>Arial</FontFamily><FontWeight>Bold</FontWeight></Style></TextRun></TextRuns><Style /></Paragraph></Paragraphs><rd:DefaultName>Textbox19</rd:DefaultName><Style><Border><Style>Solid</Style></Border><PaddingLeft>2pt</PaddingLeft><PaddingRight>2pt</PaddingRight><PaddingTop>2pt</PaddingTop><PaddingBottom>2pt</PaddingBottom></Style></Textbox></CellContents></TablixCell><TablixCell><CellContents><Textbox Name="Textbox21"><CanGrow>true</CanGrow><KeepTogether>true</KeepTogether><Paragraphs><Paragraph><TextRuns><TextRun><Value>Name As Contact</Value><Style><FontFamily>Arial</FontFamily><FontWeight>Bold</FontWeight></Style></TextRun></TextRuns><Style /></Paragraph></Paragraphs><rd:DefaultName>Textbox21</rd:DefaultName><Style><Border><Style>Solid</Style></Border><PaddingLeft>2pt</PaddingLeft><PaddingRight>2pt</PaddingRight><PaddingTop>2pt</PaddingTop><PaddingBottom>2pt</PaddingBottom></Style></Textbox></CellContents></TablixCell><TablixCell><CellContents><Textbox Name="Textbox23"><CanGrow>true</CanGrow><KeepTogether>true</KeepTogether><Paragraphs><Paragraph><TextRuns><TextRun><Value>Name As Student</Value><Style><FontFamily>Arial</FontFamily><FontWeight>Bold</FontWeight></Style></TextRun></TextRuns><Style /></Paragraph></Paragraphs><rd:DefaultName>Textbox23</rd:DefaultName><Style><Border><Style>Solid</Style></Border><PaddingLeft>2pt</PaddingLeft><PaddingRight>2pt</PaddingRight><PaddingTop>2pt</PaddingTop><PaddingBottom>2pt</PaddingBottom></Style></Textbox></CellContents></TablixCell><TablixCell><CellContents><Textbox Name="Textbox2"><CanGrow>true</CanGrow><KeepTogether>true</KeepTogether><Paragraphs><Paragraph><TextRuns><TextRun><Value>Student Status</Value><Style><FontFamily>Arial</FontFamily><FontWeight>Bold</FontWeight></Style></TextRun></TextRuns><Style /></Paragraph></Paragraphs><rd:DefaultName>Textbox2</rd:DefaultName><Style><Border><Style>Solid</Style></Border><PaddingLeft>2pt</PaddingLeft><PaddingRight>2pt</PaddingRight><PaddingTop>2pt</PaddingTop><PaddingBottom>2pt</PaddingBottom></Style></Textbox></CellContents></TablixCell><TablixCell><CellContents><Textbox Name="Textbox1"><CanGrow>true</CanGrow><KeepTogether>true</KeepTogether><Paragraphs><Paragraph><TextRuns><TextRun><Value>Form</Value><Style><FontFamily>Arial</FontFamily><FontWeight>Bold</FontWeight></Style></TextRun></TextRuns><Style /></Paragraph></Paragraphs><rd:DefaultName>Textbox1</rd:DefaultName><Style><Border><Style>Solid</Style></Border><PaddingLeft>2pt</PaddingLeft><PaddingRight>2pt</PaddingRight><PaddingTop>2pt</PaddingTop><PaddingBottom>2pt</PaddingBottom></Style></Textbox></CellContents></TablixCell><TablixCell><CellContents><Textbox Name="Textbox25"><CanGrow>true</CanGrow><KeepTogether>true</KeepTogether><Paragraphs><Paragraph><TextRuns><TextRun><Value>Name As Staff</Value><Style><FontFamily>Arial</FontFamily><FontWeight>Bold</FontWeight></Style></TextRun></TextRuns><Style /></Paragraph></Paragraphs><rd:DefaultName>Textbox25</rd:DefaultName><Style><Border><Style>Solid</Style></Border><PaddingLeft>2pt</PaddingLeft><PaddingRight>2pt</PaddingRight><PaddingTop>2pt</PaddingTop><PaddingBottom>2pt</PaddingBottom></Style></Textbox></CellContents></TablixCell></TablixCells></TablixRow><TablixRow><Height>0.6cm</Height><TablixCells><TablixCell><CellContents><Textbox Name="txtConsentRegisterName"><CanGrow>true</CanGrow><KeepTogether>true</KeepTogether><Paragraphs><Paragraph><TextRuns><TextRun><Value>=Fields!txtConsentRegisterName.Value</Value><Style><FontFamily>Arial</FontFamily></Style></TextRun></TextRuns><Style /></Paragraph></Paragraphs><rd:DefaultName>txtConsentRegisterName</rd:DefaultName><Style><Border><Style>Solid</Style></Border><PaddingLeft>2pt</PaddingLeft><PaddingRight>2pt</PaddingRight><PaddingTop>2pt</PaddingTop><PaddingBottom>2pt</PaddingBottom></Style></Textbox></CellContents></TablixCell><TablixCell><CellContents><Textbox Name="txtConsentRegisterIsEnabled"><CanGrow>true</CanGrow><KeepTogether>true</KeepTogether><Paragraphs><Paragraph><TextRuns><TextRun><Value>=Fields!txtConsentRegisterIsEnabled.Value</Value><Style><FontFamily>Arial</FontFamily></Style></TextRun></TextRuns><Style /></Paragraph></Paragraphs><rd:DefaultName>txtConsentRegisterIsEnabled</rd:DefaultName><Style><Border><Style>Solid</Style></Border><PaddingLeft>2pt</PaddingLeft><PaddingRight>2pt</PaddingRight><PaddingTop>2pt</PaddingTop><PaddingBottom>2pt</PaddingBottom></Style></Textbox></CellContents></TablixCell><TablixCell><CellContents><Textbox Name="txtStatus"><CanGrow>true</CanGrow><KeepTogether>true</KeepTogether><Paragraphs><Paragraph><TextRuns><TextRun><Value>=Fields!txtStatus.Value</Value><Style><FontFamily>Arial</FontFamily></Style></TextRun></TextRuns><Style /></Paragraph></Paragraphs><rd:DefaultName>txtStatus</rd:DefaultName><Style><Border><Style>Solid</Style></Border><PaddingLeft>2pt</PaddingLeft><PaddingRight>2pt</PaddingRight><PaddingTop>2pt</PaddingTop><PaddingBottom>2pt</PaddingBottom></Style></Textbox></CellContents></TablixCell><TablixCell><CellContents><Textbox Name="txtNameAsContact"><CanGrow>true</CanGrow><KeepTogether>true</KeepTogether><Paragraphs><Paragraph><TextRuns><TextRun><Value>=Fields!txtNameAsContact.Value</Value><Style><FontFamily>Arial</FontFamily></Style></TextRun></TextRuns><Style /></Paragraph></Paragraphs><rd:DefaultName>txtNameAsContact</rd:DefaultName><Style><Border><Style>Solid</Style><Width>0.5pt</Width></Border><PaddingLeft>2pt</PaddingLeft><PaddingRight>2pt</PaddingRight><PaddingTop>2pt</PaddingTop><PaddingBottom>2pt</PaddingBottom></Style></Textbox></CellContents></TablixCell><TablixCell><CellContents><Textbox Name="NameAsStudent1"><CanGrow>true</CanGrow><KeepTogether>true</KeepTogether><Paragraphs><Paragraph><TextRuns><TextRun><Value>=IIF(Fields!txtNameAsStudent.Value = "", IIF(Fields!txtStudentTitle.Value = "", LEFT(Fields!txtStudentForename.Value,1) &amp; " " &amp; Fields!txtStudentSurname.Value, Fields!txtStudentTitle.Value &amp; " " &amp; LEFT(Fields!txtStudentForename.Value,1) &amp; " " &amp; Fields!txtStudentSurname.Value), Fields!txtNameAsStudent.Value)</Value><Style><FontFamily>Arial</FontFamily></Style></TextRun></TextRuns><Style /></Paragraph></Paragraphs><rd:DefaultName>NameAsStudent1</rd:DefaultName><Style><Border><Style>Solid</Style><Width>0.5pt</Width></Border><PaddingLeft>2pt</PaddingLeft><PaddingRight>2pt</PaddingRight><PaddingTop>2pt</PaddingTop><PaddingBottom>2pt</PaddingBottom></Style></Textbox></CellContents></TablixCell><TablixCell><CellContents><Textbox Name="txtStudentSystemStatus"><CanGrow>true</CanGrow><KeepTogether>true</KeepTogether><Paragraphs><Paragraph><TextRuns><TextRun><Value>=SWITCH(
Fields!intSystemStatus.Value = -1, "Archived/Left",
Fields!intSystemStatus.Value = 0, "Not Yet Arrived",
Fields!intSystemStatus.Value = 1, "At School",
True, Fields!intSystemStatus.Value
)</Value><Style><FontFamily>Arial</FontFamily></Style></TextRun></TextRuns><Style /></Paragraph></Paragraphs><rd:DefaultName>txtStudentSystemStatus</rd:DefaultName><Style><Border><Style>Solid</Style><Width>0.5pt</Width></Border><PaddingLeft>2pt</PaddingLeft><PaddingRight>2pt</PaddingRight><PaddingTop>2pt</PaddingTop><PaddingBottom>2pt</PaddingBottom></Style></Textbox></CellContents></TablixCell><TablixCell><CellContents><Textbox Name="txtForm"><CanGrow>true</CanGrow><KeepTogether>true</KeepTogether><Paragraphs><Paragraph><TextRuns><TextRun><Value>=Fields!txtForm.Value</Value><Style><FontFamily>Arial</FontFamily></Style></TextRun></TextRuns><Style /></Paragraph></Paragraphs><rd:DefaultName>txtForm</rd:DefaultName><Style><Border><Style>Solid</Style><Width>0.5pt</Width></Border><PaddingLeft>2pt</PaddingLeft><PaddingRight>2pt</PaddingRight><PaddingTop>2pt</PaddingTop><PaddingBottom>2pt</PaddingBottom></Style></Textbox></CellContents></TablixCell><TablixCell><CellContents><Textbox Name="NameAsStaff1"><CanGrow>true</CanGrow><KeepTogether>true</KeepTogether><Paragraphs><Paragraph><TextRuns><TextRun><Value>=IIF(Fields!txtNameAsStaff.Value = "", Fields!txtStaffForename.Value &amp; " " &amp; Fields!txtStaffSurname.Value, Fields!txtNameAsStaff.Value)</Value><Style><FontFamily>Arial</FontFamily></Style></TextRun></TextRuns><Style /></Paragraph></Paragraphs><rd:DefaultName>NameAsStaff1</rd:DefaultName><Style><Border><Style>Solid</Style><Width>0.5pt</Width></Border><PaddingLeft>2pt</PaddingLeft><PaddingRight>2pt</PaddingRight><PaddingTop>2pt</PaddingTop><PaddingBottom>2pt</PaddingBottom></Style></Textbox></CellContents></TablixCell></TablixCells></TablixRow></TablixRows></TablixBody><TablixColumnHierarchy><TablixMembers><TablixMember /><TablixMember /><TablixMember /><TablixMember><Visibility><Hidden>=IIF(Parameters!includeContacts.Value = 0, True, False)</Hidden></Visibility></TablixMember><TablixMember><Visibility><Hidden>=IIF(Parameters!includeStudents.Value = 0, True, False)</Hidden></Visibility></TablixMember><TablixMember><Visibility><Hidden>=IIF(Parameters!includeStudents.Value = 0, True, False)</Hidden></Visibility></TablixMember><TablixMember><Visibility><Hidden>=IIF(Parameters!includeStudents.Value = 0, True, False)</Hidden></Visibility></TablixMember><TablixMember><Visibility><Hidden>=IIF(Parameters!includeStaff.Value = 0, True, False)</Hidden></Visibility></TablixMember></TablixMembers></TablixColumnHierarchy><TablixRowHierarchy><TablixMembers><TablixMember><KeepWithGroup>After</KeepWithGroup></TablixMember><TablixMember><Group Name="GroupDetails"><GroupExpressions><GroupExpression>=Fields!txtConsentRegisterName.Value</GroupExpression><GroupExpression>=Fields!txtConsentRegisterIsEnabled.Value</GroupExpression><GroupExpression>=Fields!txtStatus.Value</GroupExpression><GroupExpression>=Fields!txtNameAsContact.Value</GroupExpression><GroupExpression>=Fields!txtNameAsStudent.Value</GroupExpression><GroupExpression>=Fields!txtNameAsStaff.Value</GroupExpression></GroupExpressions></Group><SortExpressions><SortExpression><Value>=Fields!txtConsentRegisterName.Value</Value></SortExpression><SortExpression><Value>=Fields!txtNameAsContact.Value</Value></SortExpression><SortExpression><Value>=Fields!txtNameAsStudent.Value</Value></SortExpression><SortExpression><Value>=Fields!txtNameAsStaff.Value</Value></SortExpression></SortExpressions></TablixMember></TablixMembers></TablixRowHierarchy><DataSetName>ConsentRegister</DataSetName><Top>0mm</Top><Left>0mm</Left><Height>1.2cm</Height><Width>25.7cm</Width><Style><Border><Style>None</Style></Border></Style></Tablix></ReportItems><Height>12mm</Height><Style><Border><Style>None</Style></Border></Style></Body><Width>257mm</Width><Page><PageFooter><Height>0.26458mm</Height><PrintOnFirstPage>true</PrintOnFirstPage><PrintOnLastPage>true</PrintOnLastPage><Style><Border><Style>None</Style></Border></Style></PageFooter><PageHeight>21cm</PageHeight><PageWidth>29.7cm</PageWidth><LeftMargin>2cm</LeftMargin><RightMargin>2cm</RightMargin><TopMargin>2cm</TopMargin><BottomMargin>2cm</BottomMargin><ColumnSpacing>0.13cm</ColumnSpacing><Style /></Page></ReportSection></ReportSections><ReportParameters><ReportParameter Name="consentRegisterIds"><DataType>String</DataType><Prompt>consent Register Ids</Prompt></ReportParameter><ReportParameter Name="includeOptedIn"><DataType>Boolean</DataType><Prompt>include Opted In</Prompt></ReportParameter><ReportParameter Name="includeOptedOut"><DataType>Boolean</DataType><Prompt>include Opted Out</Prompt></ReportParameter><ReportParameter Name="includeNoResponse"><DataType>Boolean</DataType><Prompt>include No Response</Prompt></ReportParameter><ReportParameter Name="includeContacts"><DataType>Boolean</DataType><Prompt>include Contacts</Prompt></ReportParameter><ReportParameter Name="includeStudents"><DataType>Boolean</DataType><Prompt>include Students</Prompt></ReportParameter><ReportParameter Name="includeStaff"><DataType>Boolean</DataType><Prompt>include Staff</Prompt></ReportParameter></ReportParameters><rd:ReportUnitType>Cm</rd:ReportUnitType><rd:ReportServerUrl>http://laptop-cbowen/ReportServer</rd:ReportServerUrl><rd:ReportID>1212b8f6-93fa-4af4-8495-e6cb44f9a636</rd:ReportID></Report>